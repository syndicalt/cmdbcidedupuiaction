<?xml version="1.0" encoding="UTF-8"?><record_update sys_domain="global" table="sys_ui_action">
    <sys_ui_action action="INSERT_OR_UPDATE">
        <action_name>create_deduplication_task</action_name>
        <active>true</active>
        <client>true</client>
        <client_script_v2><![CDATA[function onClick(g_form) {

}]]></client_script_v2>
        <comments/>
        <condition/>
        <form_action>false</form_action>
        <form_button>false</form_button>
        <form_button_v2>false</form_button_v2>
        <form_context_menu>false</form_context_menu>
        <form_link>false</form_link>
        <form_menu_button_v2>false</form_menu_button_v2>
        <form_style/>
        <format_for_configurable_workspace>false</format_for_configurable_workspace>
        <hint/>
        <isolate_script>true</isolate_script>
        <list_action>true</list_action>
        <list_banner_button>true</list_banner_button>
        <list_button>false</list_button>
        <list_choice>false</list_choice>
        <list_context_menu>false</list_context_menu>
        <list_link>false</list_link>
        <list_save_with_form_button>false</list_save_with_form_button>
        <list_style/>
        <messages/>
        <name>Create De-Duplication Task</name>
        <onclick>getConfigItems()</onclick>
        <order>100</order>
        <script><![CDATA[/** 
 * Retrieves selected configuration items, creates a deduplication task, and handles user interaction.
 *
 * This function performs the following steps:
 * 1. Gets the selected CI system IDs
 * 2. Retrieves CI names or identifiers
 * 3. Displays a confirmation dialog with selected CIs
 * 4. If confirmed, creates a deduplication task via AJAX call
 * 5. Handles the response, showing success or error messages
 *
 * @function
 * @returns {void}
 * @throws {Error} Throws an error if any step in the process fails
 */
function getConfigItems() {
    /** @type {string} Comma-separated list of selected CI system IDs */
    var sys_ids = g_list.getChecked().toString();
    /** @type {string[]} Array of selected CI system IDs */
    var sys_id_list = sys_ids.split(",");
    /** @type {string[]} Array to store CI names or identifiers */
    var ci_names = [];

    try {
        if (sys_id_list.length > 1) {
            /** @type {GlideRecord} GlideRecord for querying CMDB CIs */
            var ci_gr = new GlideRecord('cmdb_ci');
            ci_gr.addQuery('sys_id', 'IN', sys_id_list);
            ci_gr.query();

            while (ci_gr.next()) {
                /** @type {string} CI name, serial number, or system ID */
                var res = ci_gr.name.toString().trim() || ci_gr.serial_number.toString().trim() || ci_gr.sys_id.toString().trim();
                ci_names.push(res);
            }

            /** @type {string} Confirmation message with selected CIs */
            var confirmation_message = 'Selected CI\'s (' + sys_id_list.length + '):\n\n';
            confirmation_message += ci_names.join('\n');
            confirmation_message += '\n\nClick OK to create de-duplication task for these CI\'s.';

            /** @type {boolean} User's response to the confirmation dialog */
            var con0 = confirm(confirmation_message);

            if (con0) {
                /** @type {GlideAjax} GlideAjax object for AJAX call */
                var dedup_utils_ga = new GlideAjax('IRSCMDBDeduplicationTaskUtils');
                dedup_utils_ga.addParam('sysparm_name', 'createDeduplicationTask');
                dedup_utils_ga.addParam('sysparm_sysids', sys_ids);
                dedup_utils_ga.getXML(function(response) {
                    /** @type {Object} Parsed response from the server */
                    var answer = JSON.parse(response.responseXML.documentElement.getAttribute('answer'));

                    if (answer.status != 200) {
                        alert(answer.response);
                    } else {
                        /** @type {string} URI of the created deduplication task */
                        var uri = 'reconcile_duplicate_task.do?sys_id=' + answer.response;
                        /** @type {boolean} User's response to view the created task */
                        var con1 = confirm('The De-duplication task has been created. Click OK to view the task record.');

                        if (con1) location.href = uri;
                    }
                });
            }
        } else {
            alert('You must select at least two CI\'s!');
        }
    } catch (e) {
        alert('An error has occurred. Please contact your administrator\n\n' + JSON.stringify(e.message));
    }
}]]></script>
        <show_insert>true</show_insert>
        <show_multiple_update>false</show_multiple_update>
        <show_query>false</show_query>
        <show_update>true</show_update>
        <sys_class_name>sys_ui_action</sys_class_name>
        <sys_created_by>B0BWB</sys_created_by>
        <sys_created_on>2024-11-25 16:05:43</sys_created_on>
        <sys_domain>global</sys_domain>
        <sys_domain_path>/</sys_domain_path>
        <sys_id>ac9b495a1b8a1e106681cbf1604bcbd8</sys_id>
        <sys_mod_count>42</sys_mod_count>
        <sys_name>Create De-Duplication Task</sys_name>
        <sys_overrides/>
        <sys_package display_value="Deduplicate Task UI Action" source="7e5a091e1b4a1e106681cbf1604bcb14">7e5a091e1b4a1e106681cbf1604bcb14</sys_package>
        <sys_policy/>
        <sys_scope display_value="Deduplicate Task UI Action">7e5a091e1b4a1e106681cbf1604bcb14</sys_scope>
        <sys_update_name>sys_ui_action_ac9b495a1b8a1e106681cbf1604bcbd8</sys_update_name>
        <sys_updated_by>B0BWB</sys_updated_by>
        <sys_updated_on>2024-12-05 19:53:02</sys_updated_on>
        <table>cmdb_ci</table>
        <ui11_compatible>true</ui11_compatible>
        <ui16_compatible>false</ui16_compatible>
    </sys_ui_action>
    <sys_es_latest_script action="INSERT_OR_UPDATE">
        <id>ac9b495a1b8a1e106681cbf1604bcbd8</id>
        <sys_created_by>B0BWB</sys_created_by>
        <sys_created_on>2024-11-25 16:05:43</sys_created_on>
        <sys_id>32acc1561bca1e106681cbf1604bcbc9</sys_id>
        <sys_mod_count>0</sys_mod_count>
        <sys_updated_by>B0BWB</sys_updated_by>
        <sys_updated_on>2024-11-25 16:05:43</sys_updated_on>
        <table>sys_ui_action</table>
        <use_es_latest>false</use_es_latest>
    </sys_es_latest_script>
</record_update>
